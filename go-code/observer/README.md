# Observer

- Observer（観察者、観測者）という名前だが、Subject（被験者）からの「通知（Notification）」が重要なパターン。
- JavaScriptのイベントループの仕組みがObserverパターンだと聞いたので、調べてみた。
- クラス図を見ればわかるが、以下のあたりがポイントかもしれない？
  - ObserverからSubjectに対する依存はなく、受動的に振る舞う
  - SubjectはObjectを知っており（≒依存しており）、Subjectのメソッドから連鎖的に `done -> notifyObservers -> (Observerの)update` という流れでメソッドが呼ばれる。
- 非同期処理などでは頻出しそうに思える（競合などの非同期特有の問題には注意が必要だろうけど）。
- とはいえ、最初からインターフェースにしておくのも難しそうな気もする。
  - 「通知」と「通知を受けての振る舞い」という流れが一種のパターン、ぐらいに捉えておく。

## クラス図

![](../images/observer.jpg)

## [フロントエンドのデザインパターン: オブザーバパターン](https://zenn.dev/morinokami/books/learning-patterns-1/viewer/observer-pattern)

ObservableとSubscriberという単語を用いている。
Pub/Subパターンと言われたほうがしっくりくる気がする。

> オブザーバパターンにより、あるオブジェクトObserverを別のオブジェクトObservableにSubscribeすることができます。
> **イベントが発生すると、Observableは自身のObserverに通知します！**

「ObservableはObserverにSubscribeできる」という言い方のほうが正しい気がする。

> オブザーバパターンにはさまざまな使用方法がありますが、非同期のイベントベースのデータを扱うときに非常に便利です。
> 例えば、あるデータのダウンロードが終了したときに特定のコンポーネントに通知したい場合や、ユーザが掲示板に新しいメッセージを送ったときに他のメンバ全員に通知したい場合などが考えられます。

この記事中の具体的な実装例でも、ボタンクリック時のイベントを対象としている。

また、RxJSというライブラリはオブザーバパターンを用いているとのこと。

> **Observableオブジェクトはイベントの監視に責任を持つのに対し、Observerは受け取ったデータを処理するだけとなります。**

これ大事だった。  
言葉の意味に気を取られると、Observer（観察者）が観察・監視の主体のように見えてしまう。  
しかしながら、実際にObserverの手前で監視する、すなわちイベントをハンドリングするのはObservable（別名Subject、被験者）である。

### 実装してみて

- 購読するobserverが関数になっている、こちらのサンプルのほうが実用的だと思った
- やっぱりPub/Subパターンと呼びたい

