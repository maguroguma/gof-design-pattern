# 良いコードとは何か

[Cyberのこのnote記事。](https://note.com/cyberz_cto/n/n26f535d6c575)

ばんくしさんが太鼓判を押していたため、流石に読まないと駄目だと思った。

読んだ感じ、凝集度・結合度をより詳細に、わかりやすく説明している部分に、この記事ならではの特に大きな価値を感じた。

---

## 凝集度

凝集度はOOPを考えるとクラスに対するものと思ってしまうけど、パッケージやメソッドなどのものにも考えられる。
SOLIDの単一責任の原則にも似ている考え方。

以下のものがあり、上のものほどまずい、下のものほど好ましい。

- 偶発的凝集
  - 必ず避ける
- 論理的凝集
  - 可能な限り避けるべき
- 時間的凝集
- 手順的凝集
- 通信的凝集
- 逐次的凝集
  - 可能な限り小さく保つ
- 機能的凝集
  - 理想的

避けるべきは最初の2つ、と考えると立ち向かいやすいかもしれない。

また、**凝集度を考えるとき「対象内の一番低いレベル」で評価されてしまう**ことに注意。
つまり、「最も悪いもの」で評価される。
当然といえば当然。

### 偶発的

適当なものの寄せ集め。
特に意味はなし。

#### なぜ避けるべきか？

当然。

### 論理的

なんか「論理的」という名前からすると好ましい性質に見えるが、どちらかというと悪いものにあたる。

「論理的に似たようなことをするものを集めたモジュール」という意味。
典型的なのは、フラグによって動作を変えるようなメソッドなど。

#### なぜ避けるべきか？

機能追加や変更があった際に、条件が増えたり複雑になる可能性があるから。

おそらく、このような場合はストラテジーパターンなど、ポリモーフィズムを使ったりするとより良くなるはず。

### 時間的

時間的に近くに動作するものを集めたモジュール。
典型的なのは、初期化処理が該当する。

「中身の実行順序を入れ替えても動作する」という特徴がある。

### 手続き的（手順的）

こちらは時間的とは対照的に、順番に意味がある集まり。

例えば、ファイルのアクセス権を確認してファイルに書き込む、といった操作などが該当する。

### 通信的

同じデータを扱う部分を集めたモジュール。
順番は重要ではない。

### 逐次的

ある部分の出力が次の入力となるような部分を集めたモジュール。

例えば、ファイルを取得し、変換して保存する等がこれに当たる。

#### なぜ小さくすべきか？

結局はいずれも手続き型のプログラミングを考えると、「ある程度の大きさになったら小さくしたほうがわかりやすいよね」というのは当然だと思う。
例えば、初期化処理にしてもDBごと、通信用モジュールごととかに分かれている方が明らかにわかりやすい。

ただし、無駄に分けすぎると認知負荷の上昇という負の側面も出てくるので、やりすぎには注意する。

### 機能的

単一の定義されたタスクを実現するモジュールで、一番良いとされている。

例えば、2点間の距離を計算するモジュールは、これ以上意味のある部分に分解できないため、機能的凝集となる。

---

## 結合度

凝集度がモジュール内の評価に使われるのに対し、結合度はモジュール間の「相互依存性の程度」を示す。
凝集度と同じく、パッケージ、クラス、メソッド等で評価可能なもの。

上のものほど悪く（密結合）、下のものほど良い（疎結合）。

- 内部結合
- 共通結合
- 外部結合
- 制御結合
- スタンプ結合
- データ結合
- メッセージ結合

以降はメソッドや関数で考えているが、パッケージとかの場合はそのまま当てはめられない気がする？

### 内部

リフレクションやC言語でいうポインタ等で、「公に宣言されていない内部データを直接書き換える」ようなこと。

当然、やりすぎでだめ。

### 共通

複数のモジュールが同じグローバルデータにアクセスできる状態のことを指す。

状態を共有するようなことになるので、良くない。

### 外部

※文献によって解釈が異なるらしい。

共通結合で考えたグローバルなデータについて、それが共通のインターフェースを持つ形で共有される状態のこと、らしい。
例えば、外部ツールや外部デバイスへの通信がこれにあたる、らしい。

### 制御

あるモジュールに何をすべきかの情報を渡すことで、別のモジュール処理の流れを制御するやりかた。
例えば、論理的凝集を外部から制御するような関数の引数などが該当する。

ドメイン知識の流出とも関係してそうで、たしかに好ましくないと思う。

### スタンプ

メソッドの引数等で、構造体やクラス等の受け渡しが該当する。
不必要にデータを渡す可能性があり、比較的結合度は高い、とのこと。

引数定義が抽象型なら、特に問題ではないと思うが？

### データ

スタンプ結合とは違い、数値や文字列等、プリミティブ型と呼ばれる単純な引数でやり取りすること。

プリミティブ型でも結合度というのを考えるのか、と思った。

### メッセージ

引数のないやり取りで、タイミングのみ等を伝えるもの。
結合度としては一番低い。

```kotlin
fun function1() {
  function2()
}
```

